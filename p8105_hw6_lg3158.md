p8105\_hw6\_lg3158
================
Ling
11/27/2021

## Problem 1

-   Data cleaning
    -   transform categorical variables as factor
        (`babysex`,`frace`,`malform`,`mrace`)
    -   check for missing values

``` r
p1 = read_csv("https://www.p8105.com/data/birthweight.csv",
              col_names = TRUE) %>%
  mutate(babysex = recode_factor(as_factor(babysex), "1" = "male","2" = "female"),
         frace = recode_factor(as_factor(frace), "1" = "White", "2" = "Black", "3" = "Asian", "4" = "Puerto Rican", "8" = "Other", "9" = "Unknown"),
         malform = recode_factor(as_factor(malform), "1" = "present", "0" = "absent"),
         mrace = recode_factor(as_factor(mrace), "1" = "White", "2" = "Black", "3" = "Asian", "4" = "Puerto Rican", "8" = "Other"))
```

    ## Rows: 4342 Columns: 20

    ## -- Column specification --------------------------------------------------------
    ## Delimiter: ","
    ## dbl (20): babysex, bhead, blength, bwt, delwt, fincome, frace, gaweeks, malf...

    ## 
    ## i Use `spec()` to retrieve the full column specification for this data.
    ## i Specify the column types or set `show_col_types = FALSE` to quiet this message.

``` r
anyNA(p1)
```

    ## [1] FALSE

-   Data description
    -   there are 20 variables and 4342 observations in the data set,
        without any missing values.
-   Regression model
    -   by common sense, gestational age in weeks, babyâ€™s head
        circumference and length at birth are associated with birth
        weight, though these are not clinically meaningful.
    -   thus, drop `bhead`, `blength`, and `gaweeks` and use the
        remained variables to construct the linear regression model
        using step-wise selection (forward process).
    -   rerun the model using `lm`.
    -   produce the plot of model residuals against fitted values.

``` r
p1_reg = p1 %>%
         select(-c(bhead, blength, gaweeks))

intercept_only_p1 = lm(bwt ~ 1, data = p1_reg)
full_p1 = lm(bwt ~ ., data = p1_reg)
forward_p1 = step(intercept_only_p1, direction = "forward", scope = formula(full_p1), trace = 0)

foward_anova = as_tibble(forward_p1$anova)
p1_reg_summary = p1_reg %>%
  lm(bwt ~ mrace + delwt + smoken + ppbmi + babysex + ppwt + mheight + fincome, data = .)

p1_reg %>%
  modelr::add_residuals(p1_reg_summary) %>%
  modelr::add_predictions(p1_reg_summary) %>%
  ggplot(aes(x = pred, y = resid)) +
    geom_point() +
    theme_minimal()
```

![](p8105_hw6_lg3158_files/figure-gfm/unnamed-chunk-2-1.png)<!-- -->

-   Cross validation

``` r
cv_df = crossv_mc(p1 , 100) %>%
  mutate(train = map(train, as_tibble),
         test = map(test, as_tibble),
         p1_linear = map(train, ~lm(bwt ~ mrace + delwt + smoken + ppbmi + babysex + ppwt + mheight + fincome, data = .)),
         p1_2 = map(train, ~ lm (bwt ~ blength + gaweeks, data = .)),
         p1_3 = map(train, ~ lm (bwt ~ bhead + blength + babysex + bhead*babysex + blength*babysex + bhead*blength, data = .)),
         rmse_linear = map2_dbl(p1_linear, test, ~ rmse(model = .x, data = .y)),
         rmse_2 = map2_dbl(p1_2, test, ~ rmse(model = .x, data = .y)),
         rmse_3 = map2_dbl(p1_3, test, ~ rmse(model = .x, data = .y))) %>%
  select(starts_with('rmse')) %>%
  pivot_longer(
    everything(),
    names_to = "model",
    values_to = "rmse",
    names_prefix = "rmse_") %>%
  mutate(model = fct_inorder(model)) %>%
  ggplot(aes(x = model, y = rmse, fill = model, color = model)) + 
    geom_violin() +
    theme_minimal()

cv_df
```

![](p8105_hw6_lg3158_files/figure-gfm/unnamed-chunk-3-1.png)<!-- -->

-   From the violin plot we can see that the model using head
    circumference, length, sex and all the interactions has the minimal
    rmse, indicating that this model fits the data best among all 3
    models.

## problem 2
